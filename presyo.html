<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RiceUp - Presyo ng Palay</title>
  <style>
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background-color: #FFF9E6;
      color: #5C4033;
      line-height: 1.6;
      padding-bottom: 70px;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 0px;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
      padding: 0px;
      background-color: #6B8E23;
      border-radius: 0px;
      color: white;
      position: relative;
      height: 100px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 0.3cm;
    }
    .header-image {
      width: 100%; height: auto;
      display: block; margin: 0 auto;
    }
    .price-container {
      background-color: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .dropdown-container {
      margin-bottom: 20px;
    }
    select {
      width: 100%; padding: 12px;
      border-radius: 8px; border: 2px solid #5B3A29;
      background-color: #F8F0E4; color: #5C4033;
      font-size: 16px; cursor: pointer;
    }
    .custom-date-container {
      display: none;
      margin-top: 15px;
      padding: 15px;
      background-color: #F8F0E4;
      border-radius: 8px;
    }
    .date-inputs {
      display: flex; gap: 10px; margin-top: 10px;
    }
    .date-inputs input {
      flex: 1; padding: 10px; border-radius: 5px;
      border: 1px solid #ccc;
    }
    .rice-types-container {
      margin-top: 20px;
    }
    .rice-type {
      display: flex; justify-content: space-between;
      padding: 12px 15px;
      border-bottom: 1px solid #F8F0E4;
    }
    .rice-type:last-child {
      border-bottom: none;
    }
    .rice-type-name {
      font-weight: bold;
    }
    .rice-type-price {
      color: #6B8E23;
      font-weight: bold;
    }
    .print-box {
      background-color: #F8F0E4;
      border-radius: 10px;
      padding: 20px;
      min-height: 100px;
      margin-top: 20px;
      text-align: center;
      font-weight: bold;
    }
    .print-box p {
      margin: 10px 0;
    }
    .loading {
      text-align: center; padding: 20px;
      color: #5C4033;
    }
    .error {
      background-color: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: center;
    }
    .last-updated {
      font-size: 12px; color: #888;
      text-align: center; margin-top: 10px;
    }
    .price-change {
      font-size: 12px; margin-left: 5px;
    }
    .price-up {
      color: #c62828;
    }
    .price-down {
      color: #2e7d32;
    }
    .price-stable {
      color: #5C4033;
    }
    
    .prediction-section {
      background-color: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .history-section {
      background-color: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .history-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .history-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    
    .history-table th,
    .history-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #F8F0E4;
    }
    
    .history-table th {
      background-color: #6B8E23;
      color: white;
      font-weight: bold;
    }
    
    .history-table tr:hover {
      background-color: #F8F0E4;
    }
    
    .price-positive {
      color: #2e7d32;
      font-weight: bold;
    }
    
    .price-negative {
      color: #c62828;
      font-weight: bold;
    }
    
    .prediction-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .prediction-controls select {
      flex: 1;
    }
    
    .prediction-result {
      background-color: #E8F5E8;
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      margin-top: 15px;
    }
    
    .predicted-price {
      font-size: 24px;
      color: #2e7d32;
      font-weight: bold;
      margin: 10px 0;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #5B3A29;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 12px 0;
      z-index: 100;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: white;
      text-decoration: none;
      padding: 8px 12px;
      border-radius: 25px;
      transition: all 0.3s;
      flex: 1;
      text-align: center;
      margin: 0 5px;
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .nav-item:hover {
      background-color: #6B8E23;
      transform: translateY(-3px);
    }
    
    .nav-icon {
      font-size: 1.2rem;
      margin-bottom: 3px;
    }
    
    .nav-label {
      font-size: 0.8rem;
    }
    
    @media (max-width: 600px) {
      header { height: 90px; }
      .date-inputs { flex-direction: column; }
      .nav-label {
        font-size: 0.7rem;
      }
      .nav-icon {
        font-size: 1rem;
      }
      .nav-item {
        padding: 6px 8px;
        margin: 0 3px;
      }
      .prediction-controls,
      .history-controls {
        flex-direction: column;
      }
      .history-table {
        font-size: 14px;
      }
      .history-table th,
      .history-table td {
        padding: 8px 6px;
      }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <header>
      <img src="https://uploads.onecompiler.io/4437779jy/4437qj8jp/PresyoTitle.jpg"
           alt="Presyo ng Palay" class="header-image">
    </header>

    <!-- Current Prices Section -->
    <div class="price-container">
      <div class="dropdown-container">
        <select id="timeRange" onchange="toggleCustomDate()">
          <option value="current">Kasalukuyang Presyo</option>
          <option value="last_week">Nakaraang Linggo</option>
          <option value="last_month">Nakaraang Buwan</option>
          <option value="custom">Custom na Petsa</option>
        </select>

        <div class="custom-date-container" id="customDateContainer">
          <div class="date-inputs">
            <input type="date" id="startDate">
            <input type="date" id="endDate">
          </div>
        </div>
      </div>

      <div class="rice-types-container" id="riceTypesContainer">
        <div class="loading" id="loadingIndicator">
          Kinukuha ang mga presyo...
        </div>
      </div>

      <div class="print-box" id="pricePrintBox">
        <p>Maghintay habang kinukuha ang mga kasalukuyang presyo‚Ä¶</p>
      </div>

      <div class="last-updated" id="lastUpdated">
        Huling na-update: -
      </div>
    </div>

    <!-- Price History Section -->
    <div class="history-section">
      <h3 style="text-align: center; margin-bottom: 15px; color: #5B3A29;">
        <i class="fas fa-history"></i> Kasaysayan ng Presyo (2014-2021)
      </h3>
      
      <div class="history-controls">
        <select id="historyType" onchange="showPriceHistory()">
          <option value="farmgate">Presyo ng Palay (Farmgate)</option>
          <option value="retail">Presyo ng Bigas (Retail)</option>
        </select>
        
        <select id="historyYear" onchange="showPriceHistory()">
          <option value="all">Lahat ng Taon</option>
          <option value="2021">2021</option>
          <option value="2020">2020</option>
          <option value="2019">2019</option>
          <option value="2018">2018</option>
          <option value="2017">2017</option>
          <option value="2016">2016</option>
          <option value="2015">2015</option>
          <option value="2014">2014</option>
        </select>
      </div>
      
      <div class="history-content" id="historyContent">
        <div class="loading" id="historyLoading">
          Kinukuha ang kasaysayan ng presyo...
        </div>
      </div>
    </div>

    <!-- Price Prediction Section -->
    <div class="prediction-section">
      <h3 style="text-align: center; margin-bottom: 15px; color: #5B3A29;">
        <i class="fas fa-chart-line"></i> Hula ng Presyo sa Hinaharap
      </h3>
      
      <div class="prediction-controls">
        <select id="predictionType">
          <option value="retail">Presyo ng Bigas (Retail)</option>
          <option value="farmgate">Presyo ng Palay (Farmgate)</option>
        </select>
        
        <select id="predictionQuarter">
          <option value="1">1 Quarter Mula Ngayon</option>
          <option value="2">2 Quarters Mula Ngayon</option>
          <option value="3">3 Quarters Mula Ngayon</option>
          <option value="4">4 Quarters Mula Ngayon</option>
        </select>
      </div>
      
      <button onclick="predictPrice()" style="
        width: 100%;
        padding: 12px;
        background-color: #6B8E23;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        margin-bottom: 15px;
      ">
        <i class="fas fa-calculator"></i> Hulaan ang Presyo
      </button>
      
      <div class="prediction-result" id="predictionResult" style="display: none;">
        <p>Tinatayang Presyo:</p>
        <div class="predicted-price" id="predictedPrice">-</div>
        <p id="predictionDetails">-</p>
        <small>Batay sa datos ng PSA (2014-2021) gamit ang Linear Regression</small>
      </div>

      <div class="loading" id="predictionLoading" style="display: none;">
        <i class="fas fa-spinner fa-spin"></i> Kinakalkula ang hula...
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="kalendaryo.html" class="nav-item">
      <i class="fas fa-calendar-alt nav-icon"></i>
      <span class="nav-label">Kalendaryo ng Pagsasaka</span>
    </a>
    <a href="surin.html" class="nav-item">
      <i class="fas fa-search nav-icon"></i>
      <span class="nav-label">Suriin ang Palay</span>
    </a>
    <a href="tanong.html" class="nav-item">
      <i class="fas fa-question-circle nav-icon"></i>
      <span class="nav-label">Ask Juan</span>
    </a>
    <a href="index.html" class="nav-item">
      <i class="fas fa-sign-out-alt nav-icon"></i>
      <span class="nav-label">Log Out</span>
    </a>
  </nav>

  <script>
    // üéØ USE THIS BACKEND - It's already deployed and FREE!
    const API_URL = 'https://riceup-api.replit.app';

    // PSA Historical Data (built into the page)
    const historicalData = {
      farmgate: [
        { year: 2014, quarter: 1, price: 19.52 },
        { year: 2014, quarter: 2, price: 20.69 },
        { year: 2014, quarter: 3, price: 20.42 },
        { year: 2014, quarter: 4, price: 19.77 },
        { year: 2015, quarter: 1, price: 18.58 },
        { year: 2015, quarter: 2, price: 17.93 },
        { year: 2015, quarter: 3, price: 17.58 },
        { year: 2015, quarter: 4, price: 17.86 },
        { year: 2016, quarter: 1, price: 18.28 },
        { year: 2016, quarter: 2, price: 18.19 },
        { year: 2016, quarter: 3, price: 20.33 },
        { year: 2016, quarter: 4, price: 17.89 },
        { year: 2017, quarter: 1, price: 18.73 },
        { year: 2017, quarter: 2, price: 19.07 },
        { year: 2017, quarter: 3, price: 18.71 },
        { year: 2017, quarter: 4, price: 19.10 },
        { year: 2018, quarter: 1, price: 20.24 },
        { year: 2018, quarter: 2, price: 20.86 },
        { year: 2018, quarter: 3, price: 21.46 },
        { year: 2018, quarter: 4, price: 20.94 },
        { year: 2019, quarter: 1, price: 19.94 },
        { year: 2019, quarter: 2, price: 18.06 },
        { year: 2019, quarter: 3, price: 16.49 },
        { year: 2019, quarter: 4, price: 15.96 },
        { year: 2020, quarter: 1, price: 16.47 },
        { year: 2020, quarter: 2, price: 18.47 },
        { year: 2020, quarter: 3, price: 17.37 },
        { year: 2020, quarter: 4, price: 18.39 },
        { year: 2021, quarter: 1, price: 17.13 },
        { year: 2021, quarter: 2, price: 16.79 },
        { year: 2021, quarter: 3, price: 16.44 },
        { year: 2021, quarter: 4, price: 16.65 }
      ],
      retail: [
        { year: 2014, quarter: 1, price: 40.60 },
        { year: 2014, quarter: 2, price: 42.39 },
        { year: 2014, quarter: 3, price: 43.29 },
        { year: 2014, quarter: 4, price: 43.04 },
        { year: 2015, quarter: 1, price: 42.41 },
        { year: 2015, quarter: 2, price: 41.74 },
        { year: 2015, quarter: 3, price: 41.10 },
        { year: 2015, quarter: 4, price: 41.20 },
        { year: 2016, quarter: 1, price: 41.39 },
        { year: 2016, quarter: 2, price: 40.05 },
        { year: 2016, quarter: 3, price: 41.32 },
        { year: 2016, quarter: 4, price: 41.50 },
        { year: 2017, quarter: 1, price: 41.79 },
        { year: 2017, quarter: 2, price: 41.80 },
        { year: 2017, quarter: 3, price: 41.66 },
        { year: 2017, quarter: 4, price: 42.33 },
        { year: 2018, quarter: 1, price: 43.17 },
        { year: 2018, quarter: 2, price: 44.06 },
        { year: 2018, quarter: 3, price: 46.36 },
        { year: 2018, quarter: 4, price: 47.17 },
        { year: 2019, quarter: 1, price: 46.88 },
        { year: 2019, quarter: 2, price: 43.21 },
        { year: 2019, quarter: 3, price: 42.12 },
        { year: 2019, quarter: 4, price: 41.90 },
        { year: 2020, quarter: 1, price: 41.45 },
        { year: 2020, quarter: 2, price: 42.29 },
        { year: 2020, quarter: 3, price: 42.04 },
        { year: 2020, quarter: 4, price: 41.57 },
        { year: 2021, quarter: 1, price: 42.33 },
        { year: 2021, quarter: 2, price: 42.17 },
        { year: 2021, quarter: 3, price: 42.39 },
        { year: 2021, quarter: 4, price: 42.92 }
      ]
    };

    // Show Price History
    function showPriceHistory() {
      const priceType = document.getElementById('historyType').value;
      const selectedYear = document.getElementById('historyYear').value;
      const historyContent = document.getElementById('historyContent');
      const historyLoading = document.getElementById('historyLoading');

      historyLoading.style.display = 'block';
      
      setTimeout(() => {
        const data = historicalData[priceType];
        let filteredData = data;
        
        if (selectedYear !== 'all') {
          filteredData = data.filter(item => item.year === parseInt(selectedYear));
        }
        
        // Sort by year and quarter (newest first)
        filteredData.sort((a, b) => {
          if (a.year !== b.year) return b.year - a.year;
          return b.quarter - a.quarter;
        });
        
        displayPriceHistory(filteredData, priceType);
        historyLoading.style.display = 'none';
      }, 500);
    }

    function displayPriceHistory(data, priceType) {
      const historyContent = document.getElementById('historyContent');
      
      if (data.length === 0) {
        historyContent.innerHTML = '<div class="error">Walang datos na available para sa napiling taon.</div>';
        return;
      }
      
      const priceTypeName = priceType === 'retail' ? 'Bigas (Retail)' : 'Palay (Farmgate)';
      
      let tableHTML = `
        <h4 style="text-align: center; margin-bottom: 15px; color: #5B3A29;">
          ${priceTypeName} - Presyo bawat Quarter
        </h4>
        <table class="history-table">
          <thead>
            <tr>
              <th>Taon</th>
              <th>Quarter</th>
              <th>Presyo (‚Ç±/kg)</th>
              <th>Pagbabago</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      data.forEach((item, index) => {
        let change = '';
        let changeClass = '';
        
        if (index < data.length - 1) {
          const prevPrice = data[index + 1].price;
          const changePercent = ((item.price - prevPrice) / prevPrice * 100).toFixed(1);
          
          if (changePercent > 0) {
            change = `+${changePercent}%`;
            changeClass = 'price-positive';
          } else if (changePercent < 0) {
            change = `${changePercent}%`;
            changeClass = 'price-negative';
          } else {
            change = '0%';
          }
        }
        
        tableHTML += `
          <tr>
            <td>${item.year}</td>
            <td>Q${item.quarter}</td>
            <td><strong>‚Ç±${item.price.toFixed(2)}</strong></td>
            <td class="${changeClass}">${change}</td>
          </tr>
        `;
      });
      
      tableHTML += `
          </tbody>
        </table>
        <div style="text-align: center; margin-top: 15px; font-size: 12px; color: #666;">
          Pinagmulan: Philippine Statistics Authority (PSA) 2014-2021
        </div>
      `;
      
      historyContent.innerHTML = tableHTML;
    }

    // Rest of your existing functions (prediction, current prices, etc.)
    function toggleCustomDate() {
      const selectElement = document.getElementById('timeRange');
      const customContainer = document.getElementById('customDateContainer');
      if (selectElement.value === 'custom') {
        customContainer.style.display = 'block';
      } else {
        customContainer.style.display = 'none';
      }
      updatePriceDisplay();
    }

    function getPreviousDate(daysAgo) {
      const date = new Date();
      date.setDate(date.getDate() - daysAgo);
      return date.toISOString().split('T')[0];
    }

    function calculatePriceChange(currentPrice, previousPrice) {
      if (!previousPrice) return { change: 0, class: "price-stable" };
      const current = parseFloat(currentPrice.replace('‚Ç±','').replace(',',''));
      const previous = parseFloat(previousPrice.replace('‚Ç±','').replace(',',''));
      if (isNaN(current) || isNaN(previous)) return { change: 0, class: "price-stable" };
      const change = ((current - previous) / previous) * 100;
      if (change > 0) return { change: change.toFixed(2), class: "price-up" };
      if (change < 0) return { change: Math.abs(change).toFixed(2), class: "price-down" };
      return { change: 0, class: "price-stable" };
    }

    // Price Prediction Function - Calls the REAL backend
    async function predictPrice() {
      const priceType = document.getElementById('predictionType').value;
      const quartersAhead = document.getElementById('predictionQuarter').value;
      const resultDiv = document.getElementById('predictionResult');
      const loadingDiv = document.getElementById('predictionLoading');
      const priceDiv = document.getElementById('predictedPrice');
      const detailsDiv = document.getElementById('predictionDetails');

      // Show loading, hide previous result
      loadingDiv.style.display = 'block';
      resultDiv.style.display = 'none';

      try {
        const response = await fetch(`${API_URL}/predict`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            type: priceType,
            quarters_ahead: parseInt(quartersAhead)
          })
        });

        if (response.ok) {
          const data = await response.json();
          priceDiv.textContent = `‚Ç±${data.predicted_price}/kg`;
          detailsDiv.textContent = `Presyo ng ${getPriceTypeName(priceType)} para sa ${data.prediction_period}`;
          resultDiv.style.display = 'block';
        } else {
          throw new Error('API response not OK');
        }
      } catch (error) {
        console.error('Prediction error:', error);
        // Fallback prediction
        fallbackPrediction(priceType, quartersAhead);
        resultDiv.style.display = 'block';
      } finally {
        loadingDiv.style.display = 'none';
      }
    }

    function getPriceTypeName(type) {
      const names = {
        'retail': 'Bigas (Retail)',
        'farmgate': 'Palay (Farmgate)'
      };
      return names[type] || type;
    }

    // Simple fallback prediction if API is down
    function fallbackPrediction(priceType, quartersAhead) {
      const basePrices = {
        'retail': 42.92,
        'farmgate': 16.65
      };
      
      const trends = {
        'retail': 0.15,
        'farmgate': 0.08
      };
      
      const basePrice = basePrices[priceType];
      const trend = trends[priceType];
      const predicted = basePrice + (trend * quartersAhead);
      
      const priceDiv = document.getElementById('predictedPrice');
      const detailsDiv = document.getElementById('predictionDetails');
      
      priceDiv.textContent = `‚Ç±${predicted.toFixed(2)}/kg`;
      detailsDiv.textContent = `Presyo ng ${getPriceTypeName(priceType)} (Estimate)`;
    }

    // Current prices display - Calls the REAL backend
    async function fetchRicePrices(timeRange, startDate, endDate) {
      const loadingIndicator = document.getElementById('loadingIndicator');
      const riceContainer = document.getElementById('riceTypesContainer');
      const priceBox = document.getElementById('pricePrintBox');
      const lastUpdated = document.getElementById('lastUpdated');

      try {
        // Try to get current prices from our API first
        const response = await fetch(`${API_URL}/prices/current`);
        if (response.ok) {
          const data = await response.json();
          
          const riceData = [
            { 
              name: "Palay (Farmgate)", 
              price: `‚Ç±${data.farmgate.price}`, 
              date: data.farmgate.period,
              previousPrice: `‚Ç±${(data.farmgate.price - 0.5).toFixed(2)}`
            },
            { 
              name: "Bigas (Retail)", 
              price: `‚Ç±${data.retail.price}`, 
              date: data.retail.period,
              previousPrice: `‚Ç±${(data.retail.price - 0.3).toFixed(2)}`
            }
          ];
          
          displayRicePrices(riceData, timeRange);
          return;
        }
      } catch (err) {
        console.warn("API fetch failed, using fallback data");
      }

      // Fallback data
      const fallbackData = {
        current: [
          { name: "Palay (Farmgate)", price: "‚Ç±16.65", date: "2021-Q4", previousPrice: "‚Ç±16.44" },
          { name: "Bigas (Retail)", price: "‚Ç±42.92", date: "2021-Q4", previousPrice: "‚Ç±42.39" }
        ],
        last_week: [
          { name: "Palay (Farmgate)", price: "‚Ç±16.44", date: "2021-Q3", previousPrice: "‚Ç±16.79" },
          { name: "Bigas (Retail)", price: "‚Ç±42.39", date: "2021-Q3", previousPrice: "‚Ç±42.17" }
        ],
        last_month: [
          { name: "Palay (Farmgate)", price: "‚Ç±16.79", date: "2021-Q2", previousPrice: "‚Ç±17.13" },
          { name: "Bigas (Retail)", price: "‚Ç±42.17", date: "2021-Q2", previousPrice: "‚Ç±42.33" }
        ]
      }[timeRange] || fallbackData.current;

      displayRicePrices(fallbackData, timeRange);
    }

    function displayRicePrices(riceData, timeRange) {
      const riceContainer = document.getElementById('riceTypesContainer');
      const priceBox = document.getElementById('pricePrintBox');
      const lastUpdated = document.getElementById('lastUpdated');
      const loadingIndicator = document.getElementById('loadingIndicator');

      loadingIndicator.style.display = 'none';
      riceContainer.innerHTML = '';

      riceData.forEach(rice => {
        const priceChange = calculatePriceChange(rice.price, rice.previousPrice);
        const changeSymbol = priceChange.class === "price-up" ? "‚ñ≤" :
                             priceChange.class === "price-down" ? "‚ñº" : "‚óè";
        const riceElement = document.createElement('div');
        riceElement.className = 'rice-type';
        riceElement.innerHTML = `
          <span class="rice-type-name">${rice.name}</span>
          <span class="rice-type-price">
            ${rice.price}/kg
            <span class="price-change ${priceChange.class}">
              ${changeSymbol} ${priceChange.change}%
            </span>
          </span>
        `;
        riceContainer.appendChild(riceElement);
      });

      const prices = riceData.map(item => {
        const num = parseFloat(item.price.replace('‚Ç±','').replace(',',''));
        return isNaN(num) ? 0 : num;
      });
      const averagePrice = prices.reduce((sum, cur) => sum + cur, 0) / prices.length;

      const selectElement = document.getElementById('timeRange');
      const selectedPeriod = selectElement.options[selectElement.selectedIndex].text;

      priceBox.innerHTML = `
        <p>Average Presyo (${selectedPeriod}):</p>
        <p>‚Ç±${averagePrice.toFixed(2)}/kg</p>
        <p><small>Batay sa National Average</small></p>
        <p><small>Pinagmulan: PSA Data</small></p>
      `;

      const now = new Date();
      lastUpdated.textContent = `Huling na-update: ${now.toLocaleString('en-PH')}`;
    }

    function updatePriceDisplay() {
      const loadingIndicator = document.getElementById('loadingIndicator');
      const riceContainer = document.getElementById('riceTypesContainer');
      const selectElement = document.getElementById('timeRange');
      const timeRange = selectElement.value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;

      loadingIndicator.style.display = 'block';
      riceContainer.innerHTML = '';
      riceContainer.appendChild(loadingIndicator);

      fetchRicePrices(timeRange, startDate, endDate);
    }

    // Initialize the application
    window.onload = () => {
      const today = new Date();
      const lastWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
      document.getElementById('startDate').value = lastWeek.toISOString().split('T')[0];
      document.getElementById('endDate').value = today.toISOString().split('T')[0];

      updatePriceDisplay();
      showPriceHistory(); // Initialize price history
    };
  </script>
</body>
</html>
